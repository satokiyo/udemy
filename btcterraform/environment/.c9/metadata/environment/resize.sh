{"filter":false,"title":"resize.sh","tooltip":"/resize.sh","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":57,"column":0},"action":"remove","lines":["pecify the desired volume size in GiB as a command-line argument. If not specified, default to 20 GiB.","SIZE=${1:-20}","","# Get the ID of the environment host Amazon EC2 instance.","INSTANCEID=$(curl http://169.254.169.254/latest/meta-data/instance-id)","","# Get the ID of the Amazon EBS volume associated with the instance.","VOLUMEID=$(aws ec2 describe-instances \\","\t  --instance-id $INSTANCEID \\","\t    --query \"Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.VolumeId\" \\","\t      --output text)","","# Resize the EBS volume.","aws ec2 modify-volume --volume-id $VOLUMEID --size $SIZE","","# Wait for the resize to finish.","while [ \\","\t  \"$(aws ec2 describe-volumes-modifications \\","\t      --volume-id $VOLUMEID \\","\t          --filters Name=modification-state,Values=\"optimizing\",\"completed\" \\","\t\t      --query \"length(VolumesModifications)\"\\","\t\t          --output text)\" != \"1\" ]; do","sleep 1","done","","#Check if we're on an NVMe filesystem","if [ $(readlink -f /dev/xvda) = \"/dev/xvda\" ]","then","\t  # Rewrite the partition table so that the partition takes up all the space that it can.","\t    sudo growpart /dev/xvda 1","","\t      # Expand the size of the file system.","\t        # Check if we are on AL2","\t\t  STR=$(cat /etc/os-release)","\t\t    SUB=\"VERSION_ID=\\\"2\\\"\"","\t\t      if [[ \"$STR\" == *\"$SUB\"* ]]","\t\t\t        then","\t\t\t\t\t    sudo xfs_growfs -d /","\t\t\t\t\t      else","\t\t\t\t\t\t          sudo resize2fs /dev/xvda1","\t\t\t\t\t\t\t    fi","","\t\t\t\t\t\t    else","\t\t\t\t\t\t\t      # Rewrite the partition table so that the partition takes up all the space that it can.","\t\t\t\t\t\t\t        sudo growpart /dev/nvme0n1 1","","\t\t\t\t\t\t\t\t  # Expand the size of the file system.","\t\t\t\t\t\t\t\t    # Check if we're on AL2","\t\t\t\t\t\t\t\t      STR=$(cat /etc/os-release)","\t\t\t\t\t\t\t\t        SUB=\"VERSION_ID=\\\"2\\\"\"","\t\t\t\t\t\t\t\t\t  if [[ \"$STR\" == *\"$SUB\"* ]]","\t\t\t\t\t\t\t\t\t\t    then","\t\t\t\t\t\t\t\t\t\t\t        sudo xfs_growfs -d /","\t\t\t\t\t\t\t\t\t\t\t\t  else","\t\t\t\t\t\t\t\t\t\t\t\t\t      sudo resize2fs /dev/nvme0n1p1","\t\t\t\t\t\t\t\t\t\t\t\t\t        fi","\t\t\t\t\t\t\t\t\t\t\t\t\tfi",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["#!/bin/bash","","# Specify the desired volume size in GiB as a command-line argument. If not specified, default to 20 GiB.","SIZE=${1:-20}","","# Get the ID of the environment host Amazon EC2 instance.","INSTANCEID=$(curl http://169.254.169.254/latest/meta-data/instance-id)","","# Get the ID of the Amazon EBS volume associated with the instance.","VOLUMEID=$(aws ec2 describe-instances \\","  --instance-id $INSTANCEID \\","  --query \"Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.VolumeId\" \\","  --output text)","","# Resize the EBS volume.","aws ec2 modify-volume --volume-id $VOLUMEID --size $SIZE","","# Wait for the resize to finish.","while [ \\","  \"$(aws ec2 describe-volumes-modifications \\","    --volume-id $VOLUMEID \\","    --filters Name=modification-state,Values=\"optimizing\",\"completed\" \\","    --query \"length(VolumesModifications)\"\\","    --output text)\" != \"1\" ]; do","sleep 1","done","","#Check if we're on an NVMe filesystem","if [ $(readlink -f /dev/xvda) = \"/dev/xvda\" ]","then","  # Rewrite the partition table so that the partition takes up all the space that it can.","  sudo growpart /dev/xvda 1","","  # Expand the size of the file system.","  # Check if we are on AL2","  STR=$(cat /etc/os-release)","  SUB=\"VERSION_ID=\\\"2\\\"\"","  if [[ \"$STR\" == *\"$SUB\"* ]]","  then","    sudo xfs_growfs -d /","  else","    sudo resize2fs /dev/xvda1","  fi","","else","  # Rewrite the partition table so that the partition takes up all the space that it can.","  sudo growpart /dev/nvme0n1 1","","  # Expand the size of the file system.","  # Check if we're on AL2","  STR=$(cat /etc/os-release)","  SUB=\"VERSION_ID=\\\"2\\\"\"","  if [[ \"$STR\" == *\"$SUB\"* ]]","  then","    sudo xfs_growfs -d /","  else","    sudo resize2fs /dev/nvme0n1p1","  fi","fi"],"id":3}]]},"ace":{"folds":[],"scrolltop":799.5,"scrollleft":0,"selection":{"start":{"row":9,"column":0},"end":{"row":9,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":48,"state":"start","mode":"ace/mode/sh"}},"timestamp":1638708049230,"hash":"39a81c8aeb2130f0c07c097bc37fae988402d298"}